{%- style -%}
  .image-gallery {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }
  .image-gallery__title {
    text-align: center;
    margin-bottom: 30px;
  }
  .image-gallery__grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
  }
  .image-gallery__item {
    position: relative;
    overflow: hidden;
    border-radius: 8px;
  }
  .image-gallery__image {
    width: 100%;
    height: auto;
    display: block;
    transition: transform 0.3s ease;
  }
  .image-gallery__item:hover .image-gallery__image {
    transform: scale(1.05);
  }
  .image-gallery__caption {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 10px;
    text-align: center;
  }
  .image-gallery__pagination {
    display: flex;
    justify-content: center;
    margin-top: 30px;
    gap: 10px;
  }
  .image-gallery__pagination-button {
    padding: 8px 16px;
    border: 1px solid #ddd;
    background: white;
    cursor: pointer;
  }
  .image-gallery__pagination-button.active {
    background: #000;
    color: white;
    border-color: #000;
  }

  @media (max-width: 1024px) {
    .image-gallery__grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  @media (max-width: 768px) {
    .image-gallery__grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  @media (max-width: 480px) {
    .image-gallery__grid {
      grid-template-columns: 1fr;
    }
  }
{%- endstyle -%}

<div class="image-gallery">
  <h2 class="image-gallery__title">{{ section.settings.title }}</h2>

  <div class="image-gallery__grid" id="gallery-grid-{{ section.id }}">
    {% for block in section.blocks %}
      <div
        class="image-gallery__item"
        style="{% if forloop.index > section.settings.images_per_page %}display:none;{% endif %}"
      >
        {% if block.settings.image != blank %}
          <img
            src="{{ block.settings.image | img_url: '600x' }}"
            alt="{{ block.settings.caption | escape }}"
            class="image-gallery__image lazyload"
            loading="lazy"
            width="600"
            height="{{ 600 | divided_by: block.settings.image.aspect_ratio | round }}"
          >
        {% else %}
          {{ 'image' | placeholder_svg_tag: 'image-gallery__image' }}
        {% endif %}
        {% if block.settings.caption != blank %}
          <div class="image-gallery__caption">{{ block.settings.caption }}</div>
        {% endif %}
      </div>
    {% endfor %}
  </div>

  {% if section.blocks.size > section.settings.images_per_page %}
    <div class="image-gallery__pagination">
      {% assign total_pages = section.blocks.size | divided_by: section.settings.images_per_page | ceil %}
      {% for i in (1..total_pages) %}
        <button
          class="image-gallery__pagination-button {% if forloop.first %}active{% endif %}"
          data-page="{{ i }}"
          data-section="{{ section.id }}"
          data-per-page="{{ section.settings.images_per_page }}"
        >
          {{ i }}
        </button>
      {% endfor %}
    </div>
  {% endif %}
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Pagination functionality
    document.querySelectorAll('[data-section="{{ section.id }}"]').forEach((button) => {
      button.addEventListener('click', function () {
        const sectionId = this.dataset.section;
        const page = parseInt(this.dataset.page);
        const perPage = parseInt(this.dataset.perPage);

        // Update active button
        document.querySelectorAll(`[data-section="${sectionId}"]`).forEach((btn) => {
          btn.classList.remove('active');
        });
        this.classList.add('active');

        // Update visible images
        const grid = document.getElementById(`gallery-grid-${sectionId}`);
        const items = grid.querySelectorAll('.image-gallery__item');

        items.forEach((item, index) => {
          const itemPage = Math.floor(index / perPage) + 1;
          item.style.display = itemPage === page ? 'block' : 'none';
        });
      });
    });
  });
</script>

{% schema %}
{
  "name": "Image Gallery",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Gallery Title",
      "default": "Our Gallery"
    },
    {
      "type": "range",
      "id": "images_per_page",
      "label": "Images per page",
      "min": 6,
      "max": 8,
      "step": 1,
      "default": 6
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "caption",
          "label": "Caption",
          "default": "Image description"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Image Gallery",
      "category": "Image",
      "blocks": [
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        },
        {
          "type": "image"
        }
      ]
    }
  ]
}
{% endschema %}
